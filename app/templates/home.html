{% extends 'base.html' %}

{% block body %}
<div class="justify-content-center container-fluid p-0 m-0">
  <div class="col-9 justify-content-center mx-auto p-0 m-0">

    <div class="justify-content-center p-0 m-0" style="flex-wrap: wrap;">

      <!-- Main Panel -->
      <div class="banner">
        <div class="row">
          <div class="text-center justify-content-center p-3 pb-0 mb-0 mx-auto">
            <h2 style="color: black;">Diabetes Data and Hypothesis Hub (D2H2)</h2>
            <h5 class="m-2 mb-0" style="color: black;"> A platform that facilitates data-driven hypothesis generation
              for
              the diabetes and related metabolic
              disorder research community. </h5>
          </div>
        </div>
        <div hidden>
          <div id="human-bulk-num">{{ numstudies[0] }}</div>
          <div id="mouse-bulk-num">{{ numstudies[1] }}</div>
          <div id="human-sc-num">{{ numstudies[2] }}</div>
          <div id="mouse-sc-num">{{ numstudies[3] }}</div>
        </div>
      </div>

      <div class="row m-2 justify-content-center">
        <div class="vertical">
          <div class="input-wrapper row mt-3">
            <input id="gpt-query" style="right: 0rem;" type="text" placeholder="Enter a gene related query..." name="text" class="input pr-0 mr-0">
            <button id="gpt-query-button" class="pl-0 ml-0 query-submit" style="width: 40px; height: 55px; top: 0rem; left: .2rem; font-size: xx-large; position: relative">
                <img src="static/img/doublearrow.png" style="width: 60%" alt="Query">
            </button>
          </div>
          <p class="m-0 p-0 pl-3 pt-2" style="font-size: smaller;">Try an example: </p>
          <a class="pl-3" style="color: rgb(10, 13, 149); font-size: smaller;" onclick="fillQueryExample('In what tissues is STAT3 expressed?')">In what tissues is STAT3 expressed?</a>,<p> 
          <a class="pl-3" style="color:rgb(10, 13, 149); font-size: smaller;" onclick="fillQueryExample('What transcription factors regulate my geneset?')">What transcription factors regulate my geneset?</a></p>
        </div>

        <div class="p-2 pt-0 mt-0 text-center col-lg-4 col-sm-6">
          <p>
            Curated transcriptomics datasets from various Type 2 Diabetes studies are made available for download,
            visualization, and enrichment analysis.
          </p>
          <h5 style="font-size: 16px;">Processed Bulk RNA-seq, Microarray, and scRNA-seq Studies</h5>
          <div class="col mb-4">
            <div class="row">
              <div class="col text-center mb-3">
                <h6>Human</h6>
                <div class="countup num-style" style="font-size: 30px;">{{ numstudies[0] + numstudies[2] }}</div>
              </div>
              <div class="col text-center mb-3">
                <h6>Mouse</h6>
                <div class="countup num-style" style="font-size: 30px;">{{ numstudies[1] + numstudies[3] }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="vertical m-5">
          <a href="{{ url_for('species_or_viewerpg', species_or_gse='human') }}">
          <button class="learn-more" >
            <span class="circle" aria-hidden="true">
              <span class="icon arrow"></span>
            </span>
            <span class="button-text">Explore Datasets</span>
          </button></a>
        </div>
      </div>


    </div>

    





    <div class=" row justify-content-center mb-2" style="flex-wrap: wrap;">

      <div class="col-lg-5 col-md-10 col-sm-10 custom-col m-2" id="visualize">

        <div class="question mt-3 justify-content-center row p-2 text-center">
          <h4>Query a Single Gene across Curated Diabetes-Related Signatures</h4>
        </div>
        <div class="mt-3 justify-content-center row mb-3">
          <label class="mt-3 mr-1 ml-4" for="gene-select"> Enter gene symbol: </label>
          <select id="gene-select" class="mt-2" data-url-genes="{{ url_for('genes_api', geo_accession='human') }}"
            style="width: 200px;"></select>
        </div>
        <div class="row text-center justify-content-center">
          <p> Try an example: <a onclick="fillSingleExampleHome('STAT3')" style="color:rgb(10, 13, 149);">STAT3</a>,
            <a onclick="fillSingleExampleHome('AKT1')" style="color:rgb(10, 13, 149);">AKT1</a>
          </p>
        </div>
        <div class="row justify-content-center">
          <!-- 
          <button class="species-tab btn btn-primary m-1" id="human" role="tab">Human </button>
          <button class="species-tab btn btn-inactive m-1" id="mouse" role="tab">Mouse </button> -->
          <label class="mt-2 mr-1" for="species-toggle">Select species: </label>
          <label class="toggle" id="species-toggle">
            <input type="checkbox" id="species-val">
            <span class="slider"></span>
            <span class="labels" data-on="Mouse" data-off="Human"></span>
          </label>
        </div>


        <div class="row ml-1 mr-1">
          <p class="mt-3" style="text-align: justify">This module provides a volcano plot visualization of the
            expression levels of a given gene in
            various Type 2 Diabetes transcriptomics signatures. Users may enter in a single gene symbol as input; the
            output is a volcano plot which plots each T2D signature by gene-specific p-value (y-axis) and fold change
            (x-axis) as well as the corresponding tables available for download.</p>
        </div>



        <div class="row justify-content-center mb-2">
          <img src="static/img/t2d-thumbnail.png" alt="" class="img-fluid img-thumbnail">
        </div>

        <div class="justify-content-center row text-center mb-2 mt-2" style="bottom: 0;"">
          <a id="appyter-home"><button type="button" class="btn btn-primary btn-group-sm mt-3 mb-2">
            <span id="appyter-action">Generate plot</span>
          </button>
          </a>
        </div>
        <div id="volcano-loading"></div>
      </div>

      


      <div class="col-lg-5 col-md-10 col-sm-10 custom-col m-2" id="enrichranalysis">

        <div class="question mt-3 p-2 justify-content-center row text-center">
          <h4>Query a Gene Set across Curated Diabetes-Related Signatures</h4>
        </div>

        <div class="row mt-4 justify-content-center" style="flex-wrap: wrap;">
          <div class="col-md-5 col-sm-7 col-lg-4 text-center mr-5 mt-4">
            <textarea name="list" rows="8" id="text-area1"
              placeholder="Paste a set of valid Entrez gene symbols (e.g. STAT3) on each row in the text-box"
              onkeyup="geneCount($(this).val(), 1)" onchange="geneCount($(this).val(), 1)"
              onfocus="geneCount($(this).val(), 1)"></textarea>
            <div class="mt-1">
              <span id="gene-count1"> 0 </span> gene(s) entered
            </div>
            <div class="text-center">
              <a id="examplefill1" style="color: rgb(10, 13, 149)">Try an example gene set</a>
            </div>

          </div>
          <div class="col-md-7 col-sm-7 col-lg-6 text-center mr-3" style="overflow-y: visible !important;">
            <p>
              File formats accepted: csv, tsv, txt file with Entrez gene symbols on each line
            </p>
            <form action="/action_page.php" style="flex-wrap: wrap;">
              <input type="file" id="gene-file1" name="filename">
            </form>
            <label class="mt-1 mr-1" for="desc1">Enter gene set description (optional): </label>
            <input class="form-control-md" id="desc1" type="text">
            <p class="mt-2">Perform enrichement analysis through Enricher with the entered or uploaded gene set agasint
              our curated
              Diabetes gene set library.
              Any overlapping gene can be submitted to the <a href="{{ url_for('singlegene_home')}}">Single Gene
                Queries</a> page and the sets of overlapping genes can be submitted to the <a
                href="{{ url_for('geneset_home') }}">Gene Set Queries page.</p>
          </div>
          <div class="flex-column justify-content-center text-center m-2" style="overflow-y: visible !important;">

          </div>
        </div>


        <div class="justify-content-center row text-center mt-1">
          <a id="diabetesEnrichr-query">
            <button type="button" class="btn btn-primary btn-group-sm mt-3 mb-3"> Submit to Enrichr
              <img src="{{ url_for('static', filename='img/enrichrlogo.png') }}" class="img-fluid mr-3"
                style="width: 45px" alt="Enrichr">
            </button>
          </a>
        </div>


      </div>
    </div>

    <div class="container justify-content-center">

      <div id="volcano-plot" class="justify-content-center centered"></div>
      <div id="buttons"></div>
      <div id="t2d-tables"></div>
    </div>

    <div class="container justify-content-center">
      <div id="enrich-res"></div>
    </div>
    <!-- Twitter Table -->
    <div class="row text-center justify-content-center" style="flex-wrap: wrap;">
      <div class="col-md-10 col-sm-10 col-lg-7 col-10 text-center custom-col mb-4 mr-2 ml-2">
        <div class="question p-2 justify-content-center row">
          <h4 class="mt-4">Recent Diabetes and Related Metabolic Disorder Publications Containing a Gene-Centric Title
          </h4>
        </div>
        <div id="tweets-res" class="mb-2 mt-1"></div>
      </div>

      <div class="col-md-6 col-sm-7 col-lg-3 text-center custom-col mb-4 mr-2 ml-2">
        <a class="twitter-timeline" data-height="600" data-chrome="nofooter noborders transparent"
          href="https://twitter.com/D2H2Bot?ref_src=twsrc%5Etfw">Tweets by D2H2Bot</a>
        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>
  </div>




  {% endblock %}
</div>
</div>

{% block footer %}
<script>
  setGene('')
  function createTweetsTable() {
    document.getElementById("tweets-res").innerHTML = "<div class='loader justify-content-center'></div>";
    $.ajax({
      url: "gettweets",
      type: "POST",
      data: {},
      dataType: 'json',
    }).done(function (response) {

      const data = response['tweets']

      var headers = data[0]
      const singlegene_link = window.location.href + '/singlegene'
      var tabletext = "<table id='table-twitter' class='styled-table'><thead><tr>"

      headers.forEach(function (header) {
        tabletext += "<th>" + header + "</th>"
      });

      tabletext += "</tr><tbody>"

      for (var k = 1; k < data.length; k++) {


        tabletext += "<tr><td>" + data[k][0] + "</td><td>" + data[k][1] + "</td><td>" + data[k][2] + "</td><td>" + data[k][3] + "</td>"
        tabletext += "<td><a href='" + data[k][4] + "' target='_blank'>" + 'link' + "</a></td>"

        var analyze = data[k][5].replaceAll('[', '').replaceAll(']', '').replaceAll(' ', '').replaceAll("'", "").split(',')
        tabletext += `<td><a href="${singlegene_link}" target='_blank',  onclick="setGene('${data[k][0]}')"><img class='mr-2' src='static/img/d2h2logo.png' style='width: 25px;'/></a>`
        tabletext += "<a href='" + analyze[1] + "' target='_blank'>" + "<img class='mr-2' src='static/img/enrichrlogo.png' style='width: 25px;'/>" + "</a>"
        tabletext += "<a href='" + analyze[2] + "' target='_blank'>" + "<img class='mr-2' src='static/img/harmonizomelogo.png' style='width: 25px;'/>" + "</a>"
        tabletext += "</td></tr>"

      }

      tabletext += "</tbody></table>";


      $(document).ready(function () {
        document.getElementById("tweets-res").innerHTML = tabletext;
        table = $('#table-twitter').DataTable({ "pageLength": 5 });
      });

    });
  }
  createTweetsTable()
  if (localStorage.hasOwnProperty("genes")) {
    $(document).ready(function () {
      var genes = localStorage['genes']
      var desc = localStorage['descset']
      localStorage.removeItem('genes');
      localStorage.removeItem('descset');
      genes = genes.split('&').join('\n')
      document.getElementById('text-area1').value = genes;
      document.getElementById('desc1').value = desc;
      geneCount(genes, 1)
      document.getElementById('enrichranalysis').scrollIntoView()
      document.getElementById('diabetesEnrichr-query').click();
    })
  }
  const countupEls = document.querySelectorAll('.countup');
  countupEls.forEach(animateCountUp);

</script>

{% endblock %}